{"version":3,"sources":["cart.service.ts"],"names":[],"mappings":"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","file":"cart.service.js","sourceRoot":"","sourcesContent":["import { Injectable, Inject } from \"@angular/core\";\nimport { Http } from '@angular/http';\nimport 'rxjs/add/operator/toPromise';\nimport { API_URL } from \"../../models/core.model\";\nimport { CorService } from \"../../core.service\";\nimport { CartModel } from \"../../models/Cart.model\";\n\n\nexport class CartService {\n    private _apiURL: String;\n    constructor(  apiURL: String, public http: Http, public corService: CorService) {\n        this._apiURL = apiURL;\n    }\n\n    getCartList(): Promise<Array<CartModel>> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.get(this._apiURL + 'carts/', { headers: headers })\n            .toPromise()\n            .then(response => response.json() as Array<CartModel>)\n            .catch(this.handleError);\n    }\n\n    createCart(Cart): Promise<CartModel> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.post(this._apiURL + 'carts/', Cart, { headers: headers })\n            .toPromise()\n            .then(response => response.json() as CartModel)\n            .catch(this.handleError);\n    }\n\n    getCartByID(id): Promise<CartModel> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.get(this._apiURL + 'carts/' + id, { headers: headers })\n            .toPromise()\n            .then(response => response.json() as CartModel)\n            .catch(this.handleError);\n    }\n\n    updateCart(Cart): Promise<CartModel> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.put(this._apiURL + 'carts/' + Cart._id, Cart, { headers: headers })\n            .toPromise()\n            .then(response => response.json() as CartModel)\n            .catch(this.handleError);\n    }\n\n    deleteCart(id): Promise<CartModel> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.delete(this._apiURL + 'carts/' + id, { headers: headers })\n            .toPromise()\n            .then(response => response.json() as CartModel)\n            .catch(this.handleError);\n    }\n\n    getCartByUser(userId): Promise<Array<CartModel>> {\n        let headers = this.corService.createAuthorizationHeader();\n        return this.http.get(this._apiURL + 'cartbyuser/' + userId, { headers: headers })\n            .toPromise()\n            .then(response => response.json() as Array<CartModel>)\n            .catch(this.handleError);\n    }\n\n\n    addToCart(product) {\n        let cartStorage = window.localStorage.getItem('gCart') ? JSON.parse(window.localStorage.getItem('gCart')) : null;\n        if (cartStorage && cartStorage.items.length > 0) {\n\n            for (var i = 0; i < cartStorage.items.length; i++) {\n                var item = cartStorage.items[i];\n                if (product._id === item.product._id) {\n                    item.qty++;\n                    item.amount = product.price * item.qty;\n                    item.discount = product.promotionprice ? (product.price - product.promotionprice) * item.qty : 0;\n                    item.totalamount = item.amount - item.discount;\n                    window.localStorage.setItem('gCart', JSON.stringify(cartStorage));\n                    this.getCartStorage();\n                    return;\n                }\n            }\n\n        }\n        if (!cartStorage) {\n            cartStorage = {\n                items: []\n            }\n        }\n        cartStorage.items.push({\n            product: product,\n            qty: 1,\n            amount: product.price,\n            discount: product.promotionprice ? (product.price - product.promotionprice) : 0,\n            totalamount: product.promotionprice\n        });\n        window.localStorage.setItem('gCart', JSON.stringify(cartStorage));\n        this.getCartStorage();\n        return;\n\n    }\n\n    getCartStorage() {\n        return window.localStorage.getItem('gCart') ? JSON.parse(window.localStorage.getItem('gCart')) : null;\n    }\n\n    saveCartStorage(cart) {\n        window.localStorage.setItem('gCart', JSON.stringify(cart));\n        return;\n    }\n\n    onCalculate(cart) {\n        cart.amount = 0;\n        cart.discount = 0;\n        cart.totalamount = 0;\n\n        for (var i = 0; i < cart.items.length; i++) {\n            let item = cart.items[i];\n            let promotionprice = item.product.promotionprice ? item.product.promotionprice : 0;\n            item.amount = item.product.price * item.qty;\n            item.discount = promotionprice > 0 ? (item.product.price - promotionprice) * item.qty : 0;\n            item.totalamount = item.amount - item.discount;\n\n            cart.amount += item.amount;\n            cart.discount += item.discount;\n            cart.totalamount += item.totalamount;\n        }\n\n        return cart;\n\n    }\n\n    private handleError(error: any): Promise<any> {\n        return Promise.reject(error.message || error);\n    }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: String, decorators: [{ type: Inject, args: [API_URL, ] }, ]},\n{type: Http, },\n{type: CorService, },\n];\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}